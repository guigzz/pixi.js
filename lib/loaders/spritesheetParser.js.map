{"version":3,"sources":["../../src/loaders/spritesheetParser.js"],"names":["spritesheetParser","resource","next","imageResourceName","name","data","type","Resource","TYPE","JSON","frames","resources","loadOptions","crossOrigin","metadata","imageMetadata","parentResource","resourcePath","getResourcePath","baseUrl","add","onImageLoad","res","error","spritesheet","Spritesheet","texture","baseTexture","url","parse","textures","isDataUrl","meta","image","resolve","replace"],"mappings":";;;;kBAIe,YACf;AACI,WAAO,SAASA,iBAAT,CAA2BC,QAA3B,EAAqCC,IAArC,EACP;AACI,YAAMC,oBAAuBF,SAASG,IAAhC,WAAN;;AAEA;AACA,YAAI,CAACH,SAASI,IAAV,IACGJ,SAASK,IAAT,KAAkBC,yBAASC,IAAT,CAAcC,IADnC,IAEG,CAACR,SAASI,IAAT,CAAcK,MAFlB,IAGG,KAAKC,SAAL,CAAeR,iBAAf,CAHP,EAKA;AACID;;AAEA;AACH;;AAED,YAAMU,cAAc;AAChBC,yBAAaZ,SAASY,WADN;AAEhBC,sBAAUb,SAASa,QAAT,CAAkBC,aAFZ;AAGhBC,4BAAgBf;AAHA,SAApB;;AAMA,YAAMgB,eAAeC,gBAAgBjB,QAAhB,EAA0B,KAAKkB,OAA/B,CAArB;;AAEA;AACA,aAAKC,GAAL,CAASjB,iBAAT,EAA4Bc,YAA5B,EAA0CL,WAA1C,EAAuD,SAASS,WAAT,CAAqBC,GAArB,EACvD;AACI,gBAAIA,IAAIC,KAAR,EACA;AACIrB,qBAAKoB,IAAIC,KAAT;;AAEA;AACH;;AAED,gBAAMC,cAAc,IAAIC,iBAAJ,CAChBH,IAAII,OAAJ,CAAYC,WADI,EAEhB1B,SAASI,IAFO,EAGhBJ,SAAS2B,GAHO,CAApB;;AAMAJ,wBAAYK,KAAZ,CAAkB,YAClB;AACI5B,yBAASuB,WAAT,GAAuBA,WAAvB;AACAvB,yBAAS6B,QAAT,GAAoBN,YAAYM,QAAhC;AACA5B;AACH,aALD;AAMH,SArBD;AAsBH,KA/CD;AAgDH,C;;QAEegB,e,GAAAA,e;;AAxDhB;;AACA;;;;AACA;;;;AAsDO,SAASA,eAAT,CAAyBjB,QAAzB,EAAmCkB,OAAnC,EACP;AACI;AACA,QAAIlB,SAAS8B,SAAb,EACA;AACI,eAAO9B,SAASI,IAAT,CAAc2B,IAAd,CAAmBC,KAA1B;AACH;;AAED,WAAOL,cAAIM,OAAJ,CAAYjC,SAAS2B,GAAT,CAAaO,OAAb,CAAqBhB,OAArB,EAA8B,EAA9B,CAAZ,EAA+ClB,SAASI,IAAT,CAAc2B,IAAd,CAAmBC,KAAlE,CAAP;AACH","file":"spritesheetParser.js","sourcesContent":["import { Resource } from 'resource-loader';\nimport url from 'url';\nimport { Spritesheet } from '../core';\n\nexport default function ()\n{\n    return function spritesheetParser(resource, next)\n    {\n        const imageResourceName = `${resource.name}_image`;\n\n        // skip if no data, its not json, it isn't spritesheet data, or the image resource already exists\n        if (!resource.data\n            || resource.type !== Resource.TYPE.JSON\n            || !resource.data.frames\n            || this.resources[imageResourceName]\n        )\n        {\n            next();\n\n            return;\n        }\n\n        const loadOptions = {\n            crossOrigin: resource.crossOrigin,\n            metadata: resource.metadata.imageMetadata,\n            parentResource: resource,\n        };\n\n        const resourcePath = getResourcePath(resource, this.baseUrl);\n\n        // load the image for this sheet\n        this.add(imageResourceName, resourcePath, loadOptions, function onImageLoad(res)\n        {\n            if (res.error)\n            {\n                next(res.error);\n\n                return;\n            }\n\n            const spritesheet = new Spritesheet(\n                res.texture.baseTexture,\n                resource.data,\n                resource.url\n            );\n\n            spritesheet.parse(() =>\n            {\n                resource.spritesheet = spritesheet;\n                resource.textures = spritesheet.textures;\n                next();\n            });\n        });\n    };\n}\n\nexport function getResourcePath(resource, baseUrl)\n{\n    // Prepend url path unless the resource image is a data url\n    if (resource.isDataUrl)\n    {\n        return resource.data.meta.image;\n    }\n\n    return url.resolve(resource.url.replace(baseUrl, ''), resource.data.meta.image);\n}\n"]}